package operatingsystems;

/*
Description:The Loader will be responsible for loading each user program into Main memory.
Each user program is loaded into main memory from location 0.A User program has to be converted from 
HEX to BINARY(Either explicitly or implicitly).We created a String Buffer that can load the Binary data 
and in turn load the data into Main Memory. 
 */


import java.io.*;
import java.lang.*;
import java.math.*;
import java.io.File;
import java.io.BufferedWriter;
import java.io.IOException;
import java.util.*;

//LOADER class that loads the data from the File System
public class LOADER extends SYSTEM {
 
	public static PCB pcb = new PCB();	
	LOADER()
	{
		
	}
	
	
	public static void First_Page_Loading()
	{
		if(PC<8)
		{
			First_Page_Number = 0;
			First_Page_Index = 0;
		}
		else if(PC>8)
		{
			First_Page_Number = (PC/8);
			First_Page_Index = (PC/8)*8;
		}
		System.out.println("First Page_Number:"+First_Page_Number);
		System.out.println("First _Page_Index:"+First_Page_Index);
		
		int fmbv_index =0;
		while(FMBV.FMBV[fmbv_index]!=true)
		{
			fmbv_index++;
		}
		fmbv_index = fmbv_index +1;
		First_Frame_Number = fmbv_index;
		First_Frame_Index = (fmbv_index*8);
		System.out.println("First_Frame_Number:"+First_Frame_Number);
		System.out.println("First_Frame_Index:"+First_Frame_Index);	
		
		for(int i=0;i<8;i++)
		{
			MEMORY.MEM[First_Frame_Index] = DISK.DISK[First_Page_Index];
			First_Frame_Index++;
			First_Page_Index++;
		}
		FMBV.FMBV[fmbv_index-1] = false;
		
		Total_Frames = Math.min(6, (DISK.Program_Segment_Length)+2);
		System.out.println("Total Frames needed:"+Total_Frames);
		Page_Index = First_Page_Index;
		Page_Number = First_Page_Number;
		Frame_Index = First_Frame_Index;
		Frame_Number = First_Frame_Number;
		LOADER.pcb.smt[0] = new SMT();
		
		for(int i=0;i<DISK.Program_Segment_Length;i++)
		{
			LOADER.pcb.smt[0].pmt.add(new PMT(i,-1,0,0));
		}
		
		LOADER.pcb.smt[0].pmt.get(Page_Number).page_no = Page_Number;
		LOADER.pcb.smt[0].pmt.get(Page_Number).frame_no = fmbv_index;
		LOADER.pcb.smt[0].pmt.get(Page_Number).ref_bit = 0;
		LOADER.pcb.smt[0].pmt.get(Page_Number).dirty_bit = 0;
		
		for(int i=0;i<DISK.Program_Segment_Length;i++)
		{
			System.out.println("PMT Values:"+LOADER.pcb.smt[0].pmt.get(i).page_no+" "+LOADER.pcb.smt[0].pmt.get(i).frame_no+ " "+LOADER.pcb.smt[0].pmt.get(i).ref_bit+" "+LOADER.pcb.smt[0].pmt.get(i).dirty_bit);
		}
		
		
	}
	
	public static String Input_Loading()
	{
	int input_page_Index = DISK.Input_Start_Index;
	int fmbv_index =0;
	while(FMBV.FMBV[fmbv_index]!=true)
	{
		fmbv_index++;
	}
	fmbv_index = fmbv_index+1;
	int input_frame_index = fmbv_index*8;
	System.out.println("Input frame Index:"+input_frame_index);
	for(int i=0;i<8;i++)
	{
		MEMORY.MEM[input_frame_index] = DISK.DISK[input_page_Index];
		input_frame_index++;
		input_page_Index++;
	}
	String input_value = MEMORY.MEM[fmbv_index*8];
	System.out.println("Input_Value Is:"+input_value);
	for(int i=0;i<100;i++)
	{
		System.out.println(i+" "+MEMORY.MEM[i]);
	}
	
	FMBV.FMBV[fmbv_index-1] = false;
	for(int i =0;i<32;i++)
	{
	System.out.println(i+" "+FMBV.FMBV[i]);
	}	
	LOADER.pcb.smt[1] = new SMT();	
	LOADER.pcb.smt[1].pmt.add(new PMT(1,-1,0,0));
	LOADER.pcb.smt[1].pmt.get(0).page_no =  DISK.Input_Start_Index/8;
	LOADER.pcb.smt[1].pmt.get(0).frame_no = fmbv_index;
	LOADER.pcb.smt[1].pmt.get(0).ref_bit = -1;
	LOADER.pcb.smt[1].pmt.get(0).dirty_bit = 0;
	
	System.out.println("SMT 1 Values:"+LOADER.pcb.smt[1].pmt.get(0).page_no+" "+LOADER.pcb.smt[1].pmt.get(0).frame_no+ " "+LOADER.pcb.smt[1].pmt.get(0).ref_bit+" "+LOADER.pcb.smt[1].pmt.get(0).dirty_bit);
	
	return input_value;
	}
	 
	
		
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	/*
	//ArrayList to store the each line of the input job
	public static ArrayList<String> lines = new ArrayList<String>();
	// ArrayList to store the hexadecimal format of numbers
	public static ArrayList<String> HD = new ArrayList<String>();
	//ArrayList to store the Binary format of numbers
	public static ArrayList<String> BIN = new ArrayList<String>();
	
	//Default LOADER Constructor to Initialize variables used in the system
	LOADER()
	{
		 
		 String each_line = null;

	        try {
	            // FileReader reads text files in the default encoding.
	            FileReader fileReader = 
	                new FileReader(FileName);

	            // Always wrap FileReader in BufferedReader.
	            BufferedReader bufferedReader = 
	                new BufferedReader(fileReader);

	            while((each_line = bufferedReader.readLine()) != null) {
	                
	            	if(each_line.length()>16)
	            	{
	            		ERROR_HANDLER.ERROR(102);
	            	}
	                lines.add(each_line);       
	            }   
	            
	            String first_line = lines.get(0);
	            String[] First_line_values = first_line.split("\\s+");
	            Job_Id = Hex_to_Dec(First_line_values[0]);
	            if(Job_Id!=1)
	            {
	            	ERROR_HANDLER.ERROR(106);
	            }
	            Base_Address = Hex_to_Dec(First_line_values[1]);
	            if(Base_Address!=0)
	            {
	            	ERROR_HANDLER.ERROR(104);
	            }
	            PC = Hex_to_Dec(First_line_values[2]);
	            Program_length = Hex_to_Dec(First_line_values[3]);
	            if(PC>Program_length)
	            {
	            	ERROR_HANDLER.ERROR(2);
	            }
	            Trace_Flag = Hex_to_Dec(First_line_values[4]);     
	            if(Trace_Flag!=1&&Trace_Flag!=0)
	            {
	            	ERROR_HANDLER.ERROR(107);
	            }
	            
	            // Always close files.
	            bufferedReader.close();         
	        }
	        catch(FileNotFoundException ex) {
	        ERROR_HANDLER.ERROR(101);
	        }
	        catch(IOException ex) {
	        	ERROR_HANDLER.ERROR(101);
	        }
	        catch(IndexOutOfBoundsException ex)
	        {
	        	
	        }
	    }
	
	//Loading the hexadecimal elements into the HexaDecimal Arraylist
	public void HexLoad()
	{
		String one_line="";
		for(int line_index=1;line_index<lines.size();line_index++)
		{
		 one_line=one_line + lines.get(line_index);
		}
		int each_word=0;
		while(each_word<one_line.length())
		{
			if(one_line.length()%4!=0)
			{
				ERROR_HANDLER.ERROR(1);
			}
			HD.add(one_line.substring(each_word,Math.min(each_word+4,one_line.length())));
			each_word = each_word+4;
		}
		
		if(HD.size()!=Program_length)
		{
			ERROR_HANDLER.ERROR(105);
		}
		
		for(int i=0;i<HD.size();i++)
		{
			if(!HD.get(i).matches("-?[0-9a-fA-F]+"))
			{
				ERROR_HANDLER.ERROR(103);
			}
			
			String first_word = Hex_to_Bin_8_bit(HD.get(i).substring(0, 2));
			String second_word = Hex_to_Bin_8_bit(HD.get(i).substring(2,4));
			BIN.add(first_word+second_word);
		}	
	}
*/	
		 
	
	
	

	
	
	
	
	
	

